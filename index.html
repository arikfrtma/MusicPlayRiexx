<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RiexxPlayToMusic (App)</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00e5e5">

  <style>
    :root{
      --bg:#000;
      --card:#0b0b0b;
      --accent:#00e5e5;
      --muted:#9aa0a6;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg, #000, #050505);
      color:#fff; min-height:100vh; display:flex; flex-direction:column;
    }
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#006f6f);display:flex;align-items:center;justify-content:center;color:#000;font-weight:800}
    nav{display:flex;gap:8px}
    nav button{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer}
    nav button.active{color:var(--accent);border-color:rgba(0,229,229,0.12)}
    main{display:grid;grid-template-columns:1fr 360px;gap:18px;padding:18px;align-items:start;flex:1}
    .card{background:var(--card);padding:16px;border-radius:12px;border:1px solid var(--glass)}
    .player-iframe{width:100%;height:320px;border-radius:10px;border:none;background:#000}
    .input-row{display:flex;gap:8px;margin-top:12px}
    input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#0e0e0e;color:#fff}
    button.cta{background:var(--accent);color:#000;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    .result{display:flex;gap:12px;padding:10px;border-radius:10px;align-items:center;border:1px solid rgba(255,255,255,0.02);margin-bottom:10px;background:rgba(255,255,255,0.01)}
    .result img{width:120px;height:68px;object-fit:cover;border-radius:8px}
    .title{flex:1;color:var(--accent);font-weight:600}
    footer{text-align:center;padding:12px;color:var(--muted);border-top:1px solid rgba(255,255,255,0.02)}
    .chat-toggle{position:fixed;right:18px;bottom:18px;background:var(--accent);color:#000;padding:12px;border-radius:999px;border:none;cursor:pointer}
    .chat-window{position:fixed;right:18px;bottom:78px;width:360px;height:520px;background:#070707;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .chat-body{flex:1;padding:12px;overflow:auto}
    .bubble{padding:10px;border-radius:10px;margin-bottom:8px;display:inline-block}
    .bot{background:#0f1720;color:#dff;align-self:flex-start}
    .user{background:#0ff;color:#000;align-self:flex-end}
    /* login modal rudimentary */
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:90}
    .modal .box{background:#0a0a0a;padding:18px;border-radius:12px;width:420px;border:1px solid rgba(255,255,255,0.03)}
    .flex-row{display:flex;gap:8px}
    .admin-badge{display:inline-block;padding:6px 8px;background:gold;color:#000;border-radius:8px;font-weight:700}
    @media(max-width:1000px){main{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">RP</div>
      <div>
        <div style="font-weight:800">RiexxPlayToMusic</div>
        <div class="small">Aplikasi musik (PWA-ready)</div>
      </div>
    </div>

    <nav>
      <button id="nav-home" class="active" onclick="show('home')">Home</button>
      <button id="nav-search" onclick="show('search')">Search</button>
      <button id="nav-tiktok" onclick="show('tiktok')">TikTok/IG</button>
      <button id="nav-playlist" onclick="show('playlist')">Playlist</button>
      <button onclick="openLogin()">Login</button>
    </nav>
  </header>

  <main>
    <!-- LEFT: player + quick add -->
    <div class="card" id="home">
      <iframe id="player" class="player-iframe" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>

      <div style="margin-top:12px;display:flex;gap:10px;align-items:center;justify-content:space-between">
        <div>
          <div id="nowTitle" style="font-weight:700;color:var(--accent)">Belum Memutar</div>
          <div id="nowMeta" class="small" style="margin-top:6px;color:var(--muted)"></div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="cta" onclick="prevTrack()">Prev</button>
          <button class="cta" onclick="nextTrack()">Next</button>
        </div>
      </div>

      <div class="section" style="margin-top:14px">
        <div style="font-weight:700;color:var(--accent)">Quick Add / Preview</div>
        <div class="input-row">
          <input id="quickUrl" placeholder="Tempel link YouTube / TikTok / Instagram" />
          <button class="cta" onclick="quickAdd()">Tambah</button>
        </div>
        <div id="quickMsg" class="small" style="margin-top:8px;color:var(--muted)"></div>
      </div>

      <div style="margin-top:18px;display:flex;gap:12px;flex-wrap:wrap;align-items:center">
        <a class="cta" href="https://www.youtube.com/@RiexxOfficial" target="_blank" style="text-decoration:none">Subscribe RiexxOfficial</a>
        <a class="cta" href="https://whatsapp.com/channel/0029VbADiLW72WU58XSGVY2P" target="_blank" style="text-decoration:none">Join WhatsApp Channel</a>
      </div>
    </div>

    <!-- RIGHT: search / tiktok / playlist -->
    <div class="card" style="height:calc(100vh - 120px);overflow:auto">
      <!-- SEARCH -->
      <div id="search" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0;color:var(--accent)">Search YouTube</h3>
          <div class="small" id="searchNote" style="color:var(--muted)">API key required</div>
        </div>
        <div class="input-row" style="margin-top:12px">
          <input id="searchQuery" placeholder="Cari judul atau artist" />
          <button class="cta" onclick="searchYouTube()">Cari</button>
        </div>
        <div id="searchResults" style="margin-top:12px"></div>
      </div>

      <!-- TIKTOK/IG -->
      <div id="tiktok" style="display:none">
        <h3 style="margin:0;color:var(--accent)">TikTok / Instagram Preview</h3>
        <div class="input-row" style="margin-top:12px">
          <input id="ttUrl" placeholder="Tempel link TikTok / IG" />
          <button class="cta" onclick="previewMedia()">Preview</button>
        </div>
        <div id="ttPreview" style="margin-top:12px"></div>
      </div>

      <!-- PLAYLIST -->
      <div id="playlist" style="display:block;margin-top:10px">
        <h3 style="margin:0;color:var(--accent)">Playlist</h3>
        <div id="playlistList" style="margin-top:12px"></div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="cta" onclick="clearPlaylist()">Hapus Semua</button>
          <button onclick="saveLocal()" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted)">Simpan Lokal</button>
        </div>
      </div>

      <!-- AUTH STATUS -->
      <div style="margin-top:18px">
        <div id="authStatus" class="small">Belum login</div>
        <div style="margin-top:8px">
          <button class="cta" onclick="openLogin()">Login / Register</button>
          <button style="margin-left:8px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)" onclick="logout()">Logout</button>
        </div>
      </div>

      <!-- CONTACTS -->
      <div style="margin-top:18px">
        <h3 style="margin:0;color:var(--accent)">Kontak Developer</h3>
        <div style="margin-top:8px" class="small">
          Telegram: <a href="https://t.me/RiexxOfficial" target="_blank" style="color:var(--accent)">@RiexxOfficial</a><br>
          WhatsApp: <a href="https://wa.me/6283898472764" target="_blank" style="color:var(--accent)">+62 838-9847-2764</a>
        </div>
      </div>

    </div>
  </main>

  <footer>© 2025 RiexxPlayToMusic</footer>

  <!-- Chat widget -->
  <button class="chat-toggle" onclick="toggleChat()">CS AI</button>
  <div id="chatWindow" class="chat-window" style="display:none">
    <div style="padding:12px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800;color:var(--accent)">Riexx CS</div>
      <div class="small" style="color:var(--muted)">Rule-based bot</div>
    </div>
    <div id="chatBody" class="chat-body">
      <div class="bubble bot">Halo! Saya asisten anda Yang di buat oleh RiexxOfficial. untuk membantu anda, Bisa bantu soal fitur.</div>
    </div>
    <div style="padding:10px;border-top:1px solid rgba(255,255,255,0.03);display:flex;gap:8px">
      <input id="chatInput" placeholder="Ketik..." style="flex:1;padding:8px;border-radius:8px;background:#0b0b0b;color:#fff;border:1px solid rgba(255,255,255,0.03)" onkeydown="if(event.key==='Enter') sendChat()" />
      <button class="cta" onclick="sendChat()">Kirim</button>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="modal" class="modal">
    <div class="box">
      <h3 style="margin:0;color:var(--accent)">Login / Register</h3>
      <div style="margin-top:12px" class="small">Masuk lewat Google.</div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="cta" onclick="googleSignIn()">Login dengan Google</button>
        <button style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)" onclick="showDevLogin()">Login Developer</button>
      </div>

      <div id="devLogin" style="margin-top:12px;display:none">
        <div class="small">Username & Password Developer</div>
        <div class="input-row" style="margin-top:8px">
          <input id="devUser" placeholder="Username" />
          <input id="devPass" placeholder="Password" type="password" />
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="cta" onclick="devLogin()">Masuk</button>
          <button style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)" onclick="closeModal()">Batal</button>
        </div>
        <div class="small" style="margin-top:8px;color:var(--muted)">Catatan: kredensial developer (client-side) = <strong>RiexDev / 123</strong></div>
      </div>

      <div style="margin-top:12px">
        <button style="background:transparent;border:none;color:var(--muted)" onclick="closeModal()">Tutup</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   CONFIG: Ganti sebelum deploy
   - YOUR_YT_API_KEY
   - FIREBASE_CONFIG (object)
   ========================= */
const API_KEY = "AIzaSyBY2izgMhc8P7X7N1hjMzY1Pe8xVK3saLY";

/* ==============
   FIREBASE INIT
   ==============
   Replace FIREBASE_CONFIG with your actual Firebase web config object.
   Example (do NOT commit your real keys to public repos):
   const FIREBASE_CONFIG = {
     apiKey: "...",
     authDomain: "your-project.firebaseapp.com",
     projectId: "...",
     appId: "1:...:web:..."
   };
*/
const FIREBASE_CONFIG = AIzaSyCf6eM_1booWeLlMiffv-gwUI4U5Ft7fks; // <- Ganti DI SINI

/* lazy load firebase scripts then init */
async function loadFirebase(){
  if(window.firebaseLoaded) return;
  // load scripts
  await loadScript('https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js');
  await loadScript('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js');
  window.firebaseLoaded = true;
  firebase.initializeApp(FIREBASE_CONFIG);
  window.auth = firebase.auth();
  // handle auth state
  auth.onAuthStateChanged(user=>{
    if(user) {
      setAuthUI(user);
      closeModal();
    } else {
      setAuthUI(null);
    }
  });
}
function loadScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s); }); }

/* ==============
   UI Routing
   ============== */
function show(section){
  ['home','search','tiktok','playlist'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.style.display = (id===section || (section==='home' && id==='home')) ? (id==='playlist' ? 'block' : 'block') : 'none';
  });
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  if(section==='home') document.getElementById('nav-home').classList.add('active');
  if(section==='search') document.getElementById('nav-search').classList.add('active');
  if(section==='tiktok') document.getElementById('nav-tiktok').classList.add('active');
  if(section==='playlist') document.getElementById('nav-playlist').classList.add('active');
}

/* ==============
   Playlist & Player
   ============== */
let playlist = JSON.parse(localStorage.getItem('riexx_playlist_app')||'[]');
let currentIndex = 0;
const player = document.getElementById('player');

function renderPlaylist(){
  const list = document.getElementById('playlistList');
  list.innerHTML = '';
  if(playlist.length===0){ list.innerHTML = '<div class="small" style="color:var(--muted)">Playlist kosong</div>'; return; }
  playlist.forEach((v,i)=>{
    const row = document.createElement('div');
    row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center';
    row.style.marginBottom='8px'; row.style.padding='8px'; row.style.background='#071'; row.style.background='#0a0a0a'; row.style.borderRadius='8px';
    row.innerHTML = `<div style="flex:1;color:var(--accent);font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${v.title}</div>
      <div style="display:flex;gap:8px">
        <button class="cta" onclick="playIndex(${i})">Putar</button>
        <button onclick="removeFromPlaylist(${i})" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)">Hapus</button>
      </div>`;
    list.appendChild(row);
  });
}

function playIndex(i){
  if(i<0||i>=playlist.length) return;
  currentIndex = i;
  const v = playlist[i];
  if(v.type==='yt'){
    player.src = `https://www.youtube.com/embed/${v.id}?autoplay=1`;
    document.getElementById('nowTitle').textContent = v.title;
    document.getElementById('nowMeta').textContent = 'YouTube';
  } else if(v.type==='tt'){
    // use embed page (TikTok may block cross-site iframe; using the embed url)
    player.src = v.embed || v.url || '';
    document.getElementById('nowTitle').textContent = v.title;
    document.getElementById('nowMeta').textContent = 'TikTok';
  } else if(v.type==='ig'){
    window.open(v.url,'_blank');
  }
}

function prevTrack(){ if(playlist.length===0) return; playIndex((currentIndex-1+playlist.length)%playlist.length); }
function nextTrack(){ if(playlist.length===0) return; playIndex((currentIndex+1)%playlist.length); }
function removeFromPlaylist(i){ playlist.splice(i,1); saveLocal(); renderPlaylist(); }
function clearPlaylist(){ if(!confirm('Hapus semua playlist?')) return; playlist=[]; saveLocal(); renderPlaylist(); }
function saveLocal(){ localStorage.setItem('riexx_playlist_app', JSON.stringify(playlist)); }

function quickAdd(){
  const url = document.getElementById('quickUrl').value.trim();
  if(!url) return;
  document.getElementById('quickMsg').textContent = '';
  const yt = extractYouTubeId(url);
  if(yt){ playlist.push({type:'yt',id:yt,title:`YouTube • ${yt}`}); saveLocal(); renderPlaylist(); document.getElementById('quickMsg').textContent='Ditambahkan (YouTube)'; document.getElementById('quickUrl').value=''; if(playlist.length===1) playIndex(0); return; }
  const tt = extractTikTokId(url);
  if(tt){ playlist.push({type:'tt',id:tt,title:`TikTok • ${tt}`, embed:`https://www.tiktok.com/embed/${tt}`, url}); saveLocal(); renderPlaylist(); document.getElementById('quickMsg').textContent='Ditambahkan (TikTok)'; document.getElementById('quickUrl').value=''; return; }
  const ig = extractInstagramUrl(url);
  if(ig){ playlist.push({type:'ig',url,title:'Instagram'}); saveLocal(); renderPlaylist(); document.getElementById('quickMsg').textContent='Ditambahkan (Instagram)'; document.getElementById('quickUrl').value=''; return; }
  document.getElementById('quickMsg').textContent='URL tidak dikenali.';
}

function extractYouTubeId(url){
  const reg = /(?:youtube\\.com.*(?:\\?|&)v=|youtu\\.be\\/|youtube\\.com\\/shorts\\/)([a-zA-Z0-9_-]{11})/;
  const m = url.match(reg); return m?m[1]:null;
}
function extractTikTokId(url){
  try{ const u=new URL(url); const p=u.pathname.split('/'); const idx=p.indexOf('video'); if(idx>=0 && p[idx+1]) return p[idx+1]; return null;}catch(e){return null;}
}
function extractInstagramUrl(url){ try{ const u=new URL(url); if(u.hostname.includes('instagram.com')) return url; return null;}catch(e){return null;} }

/* ==============
   YouTube Search
   ============== */
async function searchYouTube(){
  const q = document.getElementById('searchQuery').value.trim();
  const out = document.getElementById('searchResults');
  out.innerHTML = '<div class="small" style="color:var(--muted)">Mencari...</div>';
  if(!q){ out.innerHTML = '<div class="small" style="color:var(--muted)">Masukkan kata kunci</div>'; return; }
  if(!API_KEY || API_KEY==='AIzaSyBY2izgMhc8P7X7N1hjMzY1Pe8xVK3saLY'){ out.innerHTML = '<div class="small" style="color:var(--muted)">API key belum di-set</div>'; return; }
  try{
    const resp = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=8&q=${encodeURIComponent(q)}&key=${API_KEY}`);
    const data = await resp.json();
    if(data.error){ out.innerHTML = `<div class="small" style="color:var(--muted)">Error: ${data.error.message}</div>`; return; }
    out.innerHTML = '';
    data.items.forEach(item=>{
      const id = item.id.videoId;
      const title = item.snippet.title;
      const thumb = item.snippet.thumbnails.medium?.url || item.snippet.thumbnails.default.url;
      const el = document.createElement('div'); el.className='result';
      el.innerHTML = `<img src="${thumb}"><div style="flex:1"><div class="title">${title}</div><div class="small">${item.snippet.channelTitle}</div></div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="cta" onclick="playDirect('${id}','${escapeQuotes(title)}')">Putar</button>
          <button onclick="addYTToPlaylist('${id}','${escapeQuotes(title)}')" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)">+ Playlist</button>
          <a href="https://www.youtube.com/watch?v=${id}" target="_blank" class="small" style="color:var(--muted);text-decoration:none">Buka di YouTube</a>
        </div>`;
      out.appendChild(el);
    });
  }catch(e){ out.innerHTML = '<div class="small" style="color:var(--muted)">Terjadi kesalahan</div>'; console.error(e); }
}
function playDirect(id,title){ document.getElementById('nowTitle').textContent = title; player.src = `https://www.youtube.com/embed/${id}?autoplay=1`; }
function addYTToPlaylist(id,title){ playlist.push({type:'yt',id,title}); saveLocal(); renderPlaylist(); }

/* ==============
   TikTok / IG preview
   ============== */
function previewMedia(){
  const url = document.getElementById('ttUrl').value.trim();
  const target = document.getElementById('ttPreview');
  target.innerHTML = '';
  if(!url){ target.innerHTML = '<div class="small" style="color:var(--muted)">Masukkan link</div>'; return; }
  const tt = extractTikTokId(url);
  const ig = extractInstagramUrl(url);
  if(tt){
    const block = document.createElement('blockquote');
    block.className = 'tiktok-embed';
    block.setAttribute('cite', url);
    block.setAttribute('data-video-id', tt);
    block.innerHTML = `<section>Loading TikTok preview... <br><a href="${escapeHtml(url)}" target="_blank">Buka di TikTok</a></section>`;
    target.appendChild(block);
    if(!document.getElementById('tt-embed-script')){ const s=document.createElement('script'); s.id='tt-embed-script'; s.src='https://www.tiktok.com/embed.js'; s.async=true; document.body.appendChild(s); }
    return;
  }
  if(ig){ target.innerHTML = `<div class="small">Instagram link detected. <a href="${escapeHtml(url)}" target="_blank">Buka di Instagram</a></div>`; return; }
  target.innerHTML = `<div class="small">Platform tidak dikenali. <a href="${escapeHtml(url)}" target="_blank">Buka link</a></div>`;
}

/* ==============
   Download safe actions
   ============== */
function openOriginal(){
  const url = document.getElementById('dlUrl')?.value?.trim() || '';
  if(!url) return;
  window.open(url,'_blank');
}

/* ==============
   Chatbot (rule-based)
   ============== */
const chatBody = document.getElementById('chatBody');
function toggleChat(){ const el=document.getElementById('chatWindow'); el.style.display = (el.style.display==='none'||!el.style.display)? 'block':'none'; }
function sendChat(){ const inp=document.getElementById('chatInput'); const txt=inp.value.trim(); if(!txt) return; appendUserBubble(txt); inp.value=''; setTimeout(()=>handleBotReply(txt),400+Math.random()*800); }
function appendUserBubble(t){ const d=document.createElement('div'); d.className='bubble user'; d.textContent=t; chatBody.appendChild(d); chatBody.scrollTop=chatBody.scrollHeight; }
function appendBotBubble(t){ const d=document.createElement('div'); d.className='bubble bot'; d.textContent=t; chatBody.appendChild(d); chatBody.scrollTop=chatBody.scrollHeight; }
function handleBotReply(msg){
  const q=msg.toLowerCase();
  const buildKeywords=['membuat web','buat web','cara buat website','kode website','bikin web'];
  if(buildKeywords.some(k=>q.includes(k))){ appendBotBubble('Maaf, saya tidak bisa membantu memberikan instruksi pembuatan website. Silakan hubungi developer atau layanan profesional.'); return; }
  if(q.includes('cara')||q.includes('pakai')){ appendBotBubble('Untuk memutar: cari atau tempel link YouTube/TikTok/IG lalu tekan Putar. Saya hanya menyediakan preview/embed resmi.'); return; }
  if(q.includes('youtube')){ appendBotBubble('Gunakan menu Search. Pastikan API key YouTube sudah diisi.'); return; }
  if(q.includes('tiktok')){ appendBotBubble('Gunakan menu TikTok/IG untuk preview. Tidak ada fitur pengunduhan.'); return; }
  if(q.includes('halo')||q.includes('hi')){ appendBotBubble('Halo! Ada yang bisa dibantu?'); return; }
  appendBotBubble('Maaf, saya belum mengerti. Coba ulangi dengan kata lain.');
}

/* ==============
   Login UI & logic
   ============== */
const modal = document.getElementById('modal');
function openLogin(){ modal.style.display='flex'; }
function closeModal(){ modal.style.display='none'; document.getElementById('devLogin').style.display='none'; }
function showDevLogin(){ document.getElementById('devLogin').style.display='block'; }

async function googleSignIn(){
  try{
    // load firebase, init if needed
    await loadFirebase();
    const provider = new firebase.auth.GoogleAuthProvider();
    const result = await auth.signInWithPopup(provider);
    // result.user handled by onAuthStateChanged
  }catch(e){
    alert('Gagal login Google: '+(e.message||e));
    console.error(e);
  }
}

function devLogin(){
  const u = document.getElementById('devUser').value.trim();
  const p = document.getElementById('devPass').value;
  // Developer credentials (client-side, not secure)
  if(u === 'RiexDev' && p === '123'){
    // create a simple developer session flag in localStorage
    localStorage.setItem('riexx_dev_logged_in','1');
    setAuthUI({displayName:'Developer',email:'dev@local'});
    closeModal();
    alert('Login developer berhasil.');
  } else {
    alert('Username atau password salah.');
  }
}

function logout(){
  // logout firebase and clear dev flag
  try{ if(window.auth) auth.signOut(); }catch(e){}
  localStorage.removeItem('riexx_dev_logged_in');
  setAuthUI(null);
}

/* reflect auth UI */
function setAuthUI(user){
  const el = document.getElementById('authStatus');
  if(user){
    const devFlag = localStorage.getItem('riexx_dev_logged_in');
    if(devFlag){
      el.innerHTML = `<span class="admin-badge">DEV</span> Signed in as Developer`;
    } else {
      el.innerHTML = `Signed in: ${user.displayName || user.email}`;
    }
  } else {
    el.innerHTML = 'Belum login';
  }
}

/* ==============
   Developer: lazy register firebase if FIREBASE_CONFIG set
   ============== */
if(typeof FIREBASE_CONFIG !== 'undefined' && FIREBASE_CONFIG && FIREBASE_CONFIG.apiKey){
  // pre-load Firebase scripts to allow Google login if user opens modal
  // but don't block page load
  loadFirebase().catch(e=>console.warn('Firebase not loaded yet', e));
} else {
  console.warn('Firebase config not set. Google Sign-In disabled until FIREBASE_CONFIG is provided.');
}

/* ==============
   Helpers + init
   ============== */
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function escapeQuotes(s){ return (s+'').replace(/'/g,"\\'").replace(/\"/g,'\\"'); }

// render playlist initially
renderPlaylist();
show('home');

/* ==============
   PWA: register service worker
   ============== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').then(()=>console.log('SW registered')).catch(err=>console.warn('SW reg failed',err));
}
</script>
</body>
</html>